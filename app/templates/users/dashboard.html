{% extends "base.html" %}

{% block content %}
    <h1>{{ current_user.username }}'s Dashboard</h1>

    <div class="row">
        <div class="col-md-6">
            <h2>Rides You're Offering</h2>
            {% if rides_offered %}
                <div class="list-group">
                    {% for ride in rides_offered %}
                    <a href="{{ url_for('rides.ride_detail', ride_id=ride.id) }}" class="list-group-item list-group-item-action">
                        {{ ride.origin }} to {{ ride.destination }}
                        <span class="badge bg-secondary float-end">{{ ride.departure_time.strftime('%Y-%m-%d %H:%M') }}</span>
                         <br><small>Seats Left: {{ride.seats_available}} | Price: ${{ "%.2f"|format(ride.price_per_seat or 0) }}</small>
                         </a>
                    {% endfor %}
                </div>
            {% else %}
                <p>You haven't offered any rides yet. <a href="{{ url_for('rides.offer_ride') }}">Offer one now?</a></p>
            {% endif %}
        </div>

        <div class="col-md-6">
            <h2>Your Booked Rides</h2>
            {% if bookings_made %}
                <div class="list-group">
                    {% for booking in bookings_made %}
                    <a href="{{ url_for('rides.ride_detail', ride_id=booking.ride_id) }}" class="list-group-item list-group-item-action">
                        {{ booking.ride.origin }} to {{ booking.ride.destination }} with {{ booking.ride.driver.username }}
                        <span class="badge bg-info float-end">{{ booking.ride.departure_time.strftime('%Y-%m-%d %H:%M') }}</span>
                         <br><small>Status: <span class="badge bg-{{ 'success' if booking.status == 'confirmed' else 'warning' }}">{{ booking.status }}</span></small>
                         {% if booking.status != 'cancelled' %}
                             <form action="{{ url_for('rides.cancel_booking', booking_id=booking.id) }}" method="POST" onsubmit="return confirm('Cancel booking?');" style="display: inline; margin-left: 10px;">
                                 <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                 <button type="submit" class="btn btn-warning btn-sm py-0">Cancel</button>
                             </form>
                         {% endif %}
                    </a>
                    {% endfor %}
                </div>
            {% else %}
                <p>You haven't booked any rides yet. <a href="{{ url_for('rides.find_ride') }}">Find one now?</a></p>
            {% endif %}
        </div>
    </div>

     {% endblock %}